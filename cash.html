<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© â€“ Ø¨Ø§Ù† Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</title>
  <meta name="theme-color" content="#1e293b" />
  <link rel="icon" href="https://moslimtech.github.io/Ban/icons/icon-192.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* --- CSS Section --- */
    body { font-family: 'Tajawal', system-ui, -apple-system, 'Segoe UI', Roboto, Arial; }
    .btn-anim { transition: transform .12s ease, box-shadow .12s ease, background-color .2s ease, border-color .2s ease; }
    .btn-anim:active { transform: translateY(1px) scale(.995); }
    .modal-backdrop { position: fixed; inset:0; background: rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:60; backdrop-filter: blur(4px); }
    .modal-card { width:95%; max-width:880px; max-height:85vh; overflow:auto; border-radius:12px; padding:16px; background:var(--card-bg); }
    :root {
      --bg: #f0f9ff; --card-bg: rgba(255, 255, 255, 0.95); --text: #0f172a; --muted: #475569; --border-color: #e5e7eb; --input-bg: #ffffff; --input-border: #d1d5db; --focus-border: #3b82f6; --tab-active-bg: #ffffff; --tab-inactive-text: #6b7280;
    }
    .dark {
      --bg: #0f172a; --card-bg: rgba(30, 41, 59, 0.7); --text: #e2e8f0; --muted: #94a3b8; --border-color: rgba(255, 255, 255, 0.1); --input-bg: rgba(51, 65, 85, 0.5); --input-border: rgba(255, 255, 255, 0.15); --focus-border: #38bdf8; --tab-active-bg: rgba(51, 65, 85, 0.6); --tab-inactive-text: #94a3b8;
    }
    body { background: var(--bg); color: var(--text); }
    .muted { color: var(--muted); }
    .main-card { background: var(--card-bg); border: 1px solid var(--border-color); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1); backdrop-filter: blur(12px); border-radius: 16px; }
    input, select { background-color: var(--input-bg); border-color: var(--input-border); color: var(--text); }
    input:focus, select:focus { border-color: var(--focus-border); box-shadow: 0 0 0 3px var(--focus-border-shadow, rgba(59, 130, 246, 0.2)); }
    .dark input:focus, .dark select:focus { --focus-border-shadow: rgba(56, 189, 248, 0.2); }
    .dark .network-btn { background-color: rgba(51, 65, 85, 0.3); }
    .network-active { background: rgba(34, 197, 94, 0.12); border-color: #22c55e; }
    .dark .network-active { background: rgba(56, 189, 248, 0.1); border-color: var(--focus-border); box-shadow: 0 0 12px rgba(56, 189, 248, 0.3); }
    .badge { padding:6px 8px; border-radius:8px; font-size:13px; }
    .confirmed { background: #dcfce7; color:#166534; }
    .pending { background: #fff7ed; color:#92400e; }
    .received { background: #dbeafe; color:#1e40af; }
    .dark .confirmed { background: rgba(74, 222, 128, 0.15); color: #a7f3d0; }
    .dark .pending { background: rgba(251, 191, 36, 0.15); color: #fde68a; }
    .dark .received { background: rgba(96, 165, 250, 0.15); color: #bfdbfe; }
    .dark .received-item { background-color: rgba(56, 189, 248, 0.05); }
    th, td { border-bottom: 1px solid var(--border-color); padding:8px 10px; text-align:right; font-size:14px; }
    table { width:100%; border-collapse: collapse; }
    .color-dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-left: 8px; vertical-align: middle; }
    .instapay-icon { display: inline-flex; align-items: center; margin-left: 8px; vertical-align: middle; }
    .instapay-stripe { width: 8px; height: 10px; }
    .instapay-stripe:first-child { background-color: #facc15; }
    .instapay-stripe:last-child { background-color: #0f172a; }
    .dark .instapay-stripe:last-child { background-color: #e2e8f0; }
    .network-btn { flex-direction: row-reverse; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 sm:p-6">
  <div class="max-w-4xl w-full">
    <header class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-4">
        <img src="https://moslimtech.github.io/Ban/icons/icon-192.png" alt="logo" class="w-12 h-12 rounded-lg shadow" />
        <div>
          <h1 class="text-lg font-bold">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h1>
          <p class="text-sm muted">Ø¨Ø§Ù† Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <a href="https://moslimtech.github.io/Ban/" class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-orange-100 dark:bg-slate-700 shadow btn-anim hover:shadow-md text-xl">ğŸ </a>
        <button id="themeToggle" class="w-10 h-10 rounded-full border border-slate-200 dark:border-slate-600 btn-anim flex items-center justify-center text-xl">ğŸŒ—</button>
        <!-- Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
        <button id="settingsBtn" class="w-10 h-10 rounded-full border border-slate-200 dark:border-slate-600 btn-anim flex items-center justify-center text-xl">âš™ï¸</button>
      </div>
    </header>

    <main class="main-card">
        <!-- Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§ ÙƒÙ…Ø§ Ù‡Ùˆ Ø­Ø§Ù„ÙŠØ§Ù‹... Ø³Ù†Ù‚ÙˆÙ… Ø¨ØªØ¹Ø¯ÙŠÙ„Ù‡ ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ© -->
        <div class="flex border-b" style="border-color: var(--border-color);">
            <button id="sendTabBtn" class="tab-btn flex-1 py-3 px-4 text-sm font-semibold transition-colors duration-200">ØªØ­ÙˆÙŠÙ„ Ø£Ù…ÙˆØ§Ù„</button>
            <button id="receiveTabBtn" class="tab-btn flex-1 py-3 px-4 text-sm font-semibold transition-colors duration-200">ØªØ³Ø¬ÙŠÙ„ Ø§Ø³ØªÙ„Ø§Ù…</button>
        </div>
        <div class="p-5 sm:p-6">
            <div id="sendPanel" class="tab-panel space-y-6">
                <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹ -->
                <p class="muted text-center py-8">Ù‚Ù… Ø¨Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø­Ø§ÙØ¸ ÙˆÙ†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­ Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âš™ï¸.</p>
            </div>
            <div id="receivePanel" class="tab-panel hidden">
                <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹ -->
                <p class="muted text-center py-8">Ù‚Ù… Ø¨Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø­Ø§ÙØ¸ ÙˆÙ†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­ Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âš™ï¸.</p>
            </div>
        </div>
        <div class="text-center p-4 border-t" style="border-color: var(--border-color);">
            <button id="historyBtn" type="button" class="px-4 py-2 rounded-xl bg-amber-100 dark:bg-amber-900/50 text-amber-800 dark:text-amber-300 font-medium btn-anim hover:shadow flex items-center gap-2 mx-auto">
            <span class="text-lg">ğŸ“œ</span> Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
            </button>
        </div>
    </main>

    <footer class="mt-4 text-center text-xs muted">Â© 2025 Ø¨Ø§Ù† Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</footer>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø³Ø¬Ù„ (Ù„Ù… ØªØªØºÙŠØ±) -->
  <div id="historyBackdrop" class="modal-backdrop hidden">
    <!-- ... -->
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
  <div id="settingsBackdrop" class="modal-backdrop hidden">
    <div class="modal-card" role="dialog" aria-modal="true">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-bold text-lg">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
        <button id="closeSettingsBtn" class="px-3 py-2 bg-gray-200 dark:bg-slate-600 rounded-lg text-sm">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>

      <!-- Ù‚Ø³Ù… Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­ -->
      <div class="space-y-4">
        <div>
          <label for="profitMarginInput" class="block text-sm font-medium muted mb-1">Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­ (%)</label>
          <input id="profitMarginInput" type="number" step="0.1" min="0" placeholder="Ù…Ø«Ø§Ù„: 2" class="w-full px-3 py-2 rounded-lg border focus:outline-none" />
          <p class="text-xs muted mt-1">Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø¨Ø© Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­.</p>
        </div>

        <hr class="dark:border-slate-700"/>

        <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸ -->
        <div>
          <h4 class="font-semibold mb-2">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸ (Ø£Ø±Ù‚Ø§Ù…Ùƒ)</h4>
          <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
          <div id="walletsList" class="space-y-2 mb-4">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
          </div>
          
          <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ø­ÙØ¸Ø© Ø¬Ø¯ÙŠØ¯Ø© -->
          <div class="p-4 rounded-lg bg-slate-50 dark:bg-slate-800/50 border dark:border-slate-700">
            <h5 class="font-semibold mb-3">Ø¥Ø¶Ø§ÙØ© Ù…Ø­ÙØ¸Ø© Ø¬Ø¯ÙŠØ¯Ø©</h5>
            <form id="addWalletForm" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label for="walletNumber" class="block text-xs font-medium muted mb-1">Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©</label>
                <input id="walletNumber" type="tel" required placeholder="01xxxxxxxxx" class="w-full px-3 py-2 rounded-lg border focus:outline-none" />
              </div>
              <div>
                <label for="walletAlias" class="block text-xs font-medium muted mb-1">Ø§Ø³Ù… Ù…Ù…ÙŠØ² (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <input id="walletAlias" type="text" placeholder="ÙÙˆØ¯Ø§ÙÙˆÙ† Ø´Ø®ØµÙŠ" class="w-full px-3 py-2 rounded-lg border focus:outline-none" />
              </div>
              <div>
                <label for="walletBalance" class="block text-xs font-medium muted mb-1">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ (Ø¬)</label>
                <input id="walletBalance" type="number" required value="0" min="0" class="w-full px-3 py-2 rounded-lg border focus:outline-none" />
              </div>
              <div>
                <label for="walletLimit" class="block text-xs font-medium muted mb-1">Ø­Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª (Ø´Ù‡Ø±ÙŠ)</label>
                <input id="walletLimit" type="number" required value="100" min="1" class="w-full px-3 py-2 rounded-lg border focus:outline-none" />
              </div>
              <div class="sm:col-span-2">
                <button type="submit" class="w-full px-4 py-2 rounded-xl bg-blue-500 text-white font-semibold btn-anim hover:bg-blue-600">
                  + Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­ÙØ¸Ø©
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>


  <script>
    // --- JavaScript Logic ---

    // ØªØ¹Ø±ÙŠÙ ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„ØµÙØ­Ø©
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsBackdrop = document.getElementById('settingsBackdrop');
    const closeSettingsBtn = document.getElementById('closeSettingsBtn');
    const profitMarginInput = document.getElementById('profitMarginInput');
    const addWalletForm = document.getElementById('addWalletForm');
    const walletsList = document.getElementById('walletsList');
    
    // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (Ø³Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
    const sendTabBtn = document.getElementById('sendTabBtn');
    const receiveTabBtn = document.getElementById('receiveTabBtn');
    const sendPanel = document.getElementById('sendPanel');
    const receivePanel = document.getElementById('receivePanel');
    const historyBtn = document.getElementById('historyBtn');
    const themeToggle = document.getElementById('themeToggle');

    // --- Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
    const DB_KEY = 'ban_pos_database_v1';

    // Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    const defaultDB = {
        settings: {
            profitMargin: 2.0 // Ù†Ø³Ø¨Ø© Ø±Ø¨Ø­ Ø§ÙØªØ±Ø§Ø¶ÙŠØ© 2%
        },
        wallets: [
            // Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ø§Ù„Ù…Ø­ÙØ¸Ø©
            // { id: '01012345678', alias: 'ÙÙˆØ¯Ø§ÙÙˆÙ† Ø´Ø®ØµÙŠ', openingBalance: 5000, limit: 100 }
        ],
        transactions: []
    };

    // ÙˆØ¸ÙŠÙØ© Ù„ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage
    function loadDB() {
        const data = localStorage.getItem(DB_KEY);
        // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        return data ? JSON.parse(data) : defaultDB;
    }

    // ÙˆØ¸ÙŠÙØ© Ù„Ø­ÙØ¸ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage
    function saveDB(db) {
        localStorage.setItem(DB_KEY, JSON.stringify(db));
    }


    // --- ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ø­Ø§ÙØ¸ ---

    // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    settingsBtn.addEventListener('click', () => {
        settingsBackdrop.classList.remove('hidden');
        loadSettingsIntoUI(); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    });

    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    closeSettingsBtn.addEventListener('click', () => {
        settingsBackdrop.classList.add('hidden');
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ø­Ø§ÙØ¸ ÙˆØ¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    function loadSettingsIntoUI() {
        const db = loadDB();
        // ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­
        profitMarginInput.value = db.settings.profitMargin;
        // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸
        renderWalletsList(db.wallets);
    }
    
    // Ø­ÙØ¸ Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ±Ù‡Ø§
    profitMarginInput.addEventListener('change', () => {
        const db = loadDB();
        const newMargin = parseFloat(profitMarginInput.value);
        if (!isNaN(newMargin) && newMargin >= 0) {
            db.settings.profitMargin = newMargin;
            saveDB(db);
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ù‡Ù†Ø§
        } else {
            alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Ø³Ø¨Ø© Ø±Ø¨Ø­ ØµØ§Ù„Ø­Ø©.');
            profitMarginInput.value = db.settings.profitMargin; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        }
    });

    // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸ ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    function renderWalletsList(wallets) {
        walletsList.innerHTML = ''; // ØªÙØ±ÙŠØº Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        if (wallets.length === 0) {
            walletsList.innerHTML = `<p class="text-sm muted text-center">Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ø­Ø§ÙØ¸ Ø¨Ø¹Ø¯.</p>`;
            return;
        }

        wallets.forEach(wallet => {
            const walletEl = document.createElement('div');
            walletEl.className = 'flex items-center justify-between p-2 rounded-lg bg-slate-100 dark:bg-slate-800';
            walletEl.innerHTML = `
                <div>
                    <p class="font-semibold">${wallet.alias || wallet.id}</p>
                    <p class="text-xs muted">Ø§Ù„Ø±ØµÙŠØ¯: ${wallet.openingBalance} Ø¬ | Ø§Ù„Ø­Ø¯: ${wallet.limit} Ù…Ø¹Ø§Ù…Ù„Ø©</p>
                </div>
                <button data-id="${wallet.id}" class="delete-wallet-btn px-2 py-1 text-xs text-red-500 hover:bg-red-100 dark:hover:bg-red-900/50 rounded">Ø­Ø°Ù</button>
            `;
            walletsList.appendChild(walletEl);
        });

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù
        document.querySelectorAll('.delete-wallet-btn').forEach(btn => {
            btn.addEventListener('click', handleDeleteWallet);
        });
    }

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø­ÙØ¸Ø© Ø¬Ø¯ÙŠØ¯Ø©
    addWalletForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const number = document.getElementById('walletNumber').value.trim();
        const alias = document.getElementById('walletAlias').value.trim();
        const balance = parseFloat(document.getElementById('walletBalance').value);
        const limit = parseInt(document.getElementById('walletLimit').value);

        if (!number || isNaN(balance) || isNaN(limit)) {
            alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.');
            return;
        }

        const db = loadDB();

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„
        if (db.wallets.some(w => w.id === number)) {
            alert('Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­ÙØ¸Ø© (Ø§Ù„Ø±Ù‚Ù…) Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„.');
            return;
        }

        db.wallets.push({ id: number, alias: alias, openingBalance: balance, limit: limit });
        saveDB(db);
        
        addWalletForm.reset(); // ØªÙØ±ÙŠØº Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        renderWalletsList(db.wallets); // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    });

    // Ø­Ø°Ù Ù…Ø­ÙØ¸Ø©
    function handleDeleteWallet(e) {
        const walletId = e.target.dataset.id;
        if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø­ÙØ¸Ø© ${walletId}ØŸ Ø³ÙŠØªÙ… Ø­Ø°ÙÙ‡Ø§ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹.`)) {
            const db = loadDB();
            db.wallets = db.wallets.filter(w => w.id !== walletId);
            saveDB(db);
            renderWalletsList(db.wallets); // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        }
    }


    // --- Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (Ù…Ø¤Ù‚ØªØ§Ù‹) ---
    function switchTab(activeTab) {
      if (activeTab === 'send') {
        sendPanel.classList.remove('hidden'); receivePanel.classList.add('hidden');
        sendTabBtn.style.backgroundColor = 'var(--tab-active-bg)'; sendTabBtn.style.color = 'var(--text)';
        receiveTabBtn.style.backgroundColor = 'transparent'; receiveTabBtn.style.color = 'var(--tab-inactive-text)';
      } else {
        sendPanel.classList.add('hidden'); receivePanel.classList.remove('hidden');
        receiveTabBtn.style.backgroundColor = 'var(--tab-active-bg)'; receiveTabBtn.style.color = 'var(--text)';
        sendTabBtn.style.backgroundColor = 'transparent'; sendTabBtn.style.color = 'var(--tab-inactive-text)';
      }
    }
    sendTabBtn.addEventListener('click', () => switchTab('send'));
    receiveTabBtn.addEventListener('click', () => switchTab('receive'));

    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    function applyTheme(mode) {
      if (mode === 'dark') {
        document.documentElement.classList.add('dark');
        localStorage.setItem('theme','dark');
      } else {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('theme','light');
      }
      switchTab(sendPanel.classList.contains('hidden') ? 'receive' : 'send');
    }
    const savedTheme = localStorage.getItem('theme') || (prefersDark ? 'dark' : 'light');
    applyTheme(savedTheme);
    themeToggle.textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
    themeToggle.addEventListener('click', () => {
      const now = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
      applyTheme(now);
      themeToggle.textContent = now === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
    });
    
    // Initial setup
    switchTab('send'); // ØªÙØ¹ÙŠÙ„ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    
  </script>
</body>
</html>
